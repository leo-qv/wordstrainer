<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>test</title>
<meta name="generator" content="EclipseCrossword" />
<style type="text/css"><!--

body, h1, h2, h3, h4, h5, h6
{
	font-family: "Segoe UI", "Franklin Gothic Medium", "Arial", sans-serif;
}

h1, h2, h3, h4, h5, h6
{
	color: #5d6a86;
}

body
{
	cursor: default;
	font-size: small;
}

.ecw-answerbox
{
	color: black;
	background-color: #FFFAF0;
	border-color: #808080;
	border-style: solid;
	border-width: 1px;
	display: block;
	padding: .75em;
	width: 240pt;
}

.ecw-box
{
	border-style: solid;
	border-width: 1pt;
	cursor: pointer;
	font-size: .12in;
	font-weight: bold;
	height: .18in;
	overflow: hidden;
	text-align: center;
	width: .18in;
}

.ecw-boxcheated_sel
{
	background-color: #FFF1D7;
	border-color: #C00000;
	color: #2080D0;
}

.ecw-boxcheated_unsel
{
	background-color: #ffffff;
	border-color: #606060;
	color: #2080D0;
}

.ecw-boxerror_sel
{
	background-color: #FFF1D7;
	border-color: #C00000;
	color: #BF0000;
}

.ecw-boxerror_unsel
{
	background-color: #FFF0F0;
	border-color: #606060;
	color: #BF0000;
}

.ecw-boxnormal_sel
{
	background-color: #FFF1D7;
	border-color: #C00000;
	color: #000000;
}

.ecw-boxnormal_unsel
{
	background-color: #ffffff;
	border-color: #606060;
	color: #000000;
}

.ecw-button
{
	width: 64pt;
}

.ecw-cluebox
{
	border-bottom-width: 1px;
	border-color: #c0c0c0;
	border-left-width: 0px;
	border-right-width: 0px;
	border-style: solid;
	border-top-width: 1px;
	margin-top: 1em;
	padding-bottom: .5em;
	padding-left: 0pt;
	padding-right: 0pt;
	padding-top: .5em;
}

.ecw-crosswordarea
{
	background-color: #D0D8E0;
	border-color: #808080;
	border-style: solid;
	border-width: 2px;
	padding: .5em;
	font-family: "Segoe UI", "Verdana", "Arial", sans-serif;
	font-size: small;
}

.ecw-copyright
{
	margin-bottom: 1em;
	font-size: x-small;
	font-family: "Segoe UI", "Franklin Gothic Medium", "Arial", sans-serif;
}

.ecw-input
{
	font-family: "Segoe UI", "Verdana", "Arial", sans-serif;
}

.ecw-wordlabel
{
	text-transform: uppercase;
	margin: 0;
}

.ecw-wordinfo
{
	font-size: 8pt;
	color: #808080;
}

.ecw-worderror
{
	color: #c00000;
	font-weight: bold;
	display: none;
	margin-top: 1em;
}

--></style>

</head><body>

<h1>test</h1>
<h3 style="margin-top: -1em;"></h3>

<div id="waitmessage" class="ecw-answerbox">
	This interactive crossword puzzle requires JavaScript and any 
	recent web browser, including Windows Internet Explorer, Mozilla Firefox, Google Chrome, or 
	Apple Safari.  If you have disabled web page scripting, please re-enable it and refresh
	the page.  If this web page is saved on your computer, you may need to click the yellow Information Bar at the top or bottom of
	the page to allow the puzzle to load.
</div>

<table cellpadding="0" cellspacing="0" border="0"><tr>

<td class="ecw-crosswordarea">

<script type="text/javascript"><!--
	CrosswordWidth = 70;
	CrosswordHeight = 70;
	Words = 140;
	WordLength = new Array(14, 18, 10, 23, 9, 8, 37, 11, 21, 19, 8, 12, 4, 11, 5, 15, 9, 6, 10, 13, 4, 6, 11, 27, 8, 9, 4, 5, 8, 6, 21, 15, 23, 16, 19, 15, 5, 13, 17, 8, 8, 6, 17, 8, 5, 14, 8, 3, 7, 10, 23, 10, 14, 3, 14, 13, 9, 10, 6, 20, 12, 17, 12, 5, 13, 10, 13, 14, 39, 8, 18, 9, 12, 17, 21, 18, 12, 5, 12, 6, 20, 14, 12, 9, 12, 15, 5, 20, 17, 23, 4, 32, 11, 12, 25, 11, 15, 36, 7, 15, 9, 17, 4, 13, 11, 5, 13, 13, 6, 4, 9, 6, 12, 17, 28, 20, 26, 14, 16, 13, 12, 4, 9, 4, 4, 3, 10, 14, 6, 4, 6, 6, 7, 10, 13, 5, 6, 4, 4, 3);
	Word = new Array("COST OF EQUITY", "COMPARABLE COMPANY", "UNDERLYING", "INITIAL PUBLIC OFFERING", "LIQUIDITY", "LEVERAGE", "BOND YIELD PLUS RISK PREMIUM APPROACH", "CALL OPTION", "RISK PREMIUM APPROACH", "EQUITY RISK PREMIUM", "DIVIDEND", "PUTABLE BOND", "BETA", "INDEPENDENT", "LEVEL", "SURVEY APPROACH", "INFLATION", "INCOME", "PROSPECTUS", "CALLABLE BOND", "BASE", "FACTOR", "COMPARABLES", "CAPITAL ASSET PRICING MODEL", "INTEREST", "PAR VALUE", "CASH", "RANGE", "EUROZONE", "VESTED", "MACROECONOMIC FACTORS", "ARITHMETIC MEAN", "COST OF PREFERRED STOCK", "OPPORTUNITY COST", "FACTOR RISK PREMIUM", "COST OF CAPITAL", "BASIS", "MARGINAL COST", "MULTIFACTOR MODEL", "ESTIMATE", "EXCHANGE", "PROFIT", "NET PRESENT VALUE", "DISCOUNT", "VALUE", "GEOMETRIC MEAN", "INDUSTRY", "VAR", "SUPPORT", "FACE VALUE", "INSTITUTIONAL INVESTORS", "BOOK VALUE", "FLOTATION COST", "CAP", "MATRIX PRICING", "DIVIDEND RATE", "CHARACTER", "ESTIMATION", "CREDIT", "SENSITIVITY ANALYSIS", "DEBT RATINGS", "CAPITAL STRUCTURE", "COST OF DEBT", "YIELD", "FINANCE LEASE", "VOLATILITY", "CAPITAL LEASE", "FREE CASH FLOW", "HISTORICAL EQUITY RISK PREMIUM APPROACH", "DURATION", "ECONOMIES OF SCALE", "ESTIMATOR", "CURRENT COST", "YIELD TO MATURITY", "NET PRESENT VALUE NPV", "FINANCIAL LEVERAGE", "RISK PREMIUM", "GAINS", "FUNDAMENTALS", "SPREAD", "DEBT-TO-EQUITY RATIO", "FINANCIAL RISK", "DEFAULT RISK", "BENCHMARK", "PUBLIC OFFER", "OPERATING LEASE", "OFFER", "DEBT-RATING APPROACH", "BUILD-UP APPROACH", "REQUIRED RATE OF RETURN", "CALL", "WEIGHTED AVERAGE COST OF CAPITAL", "COUPON RATE", "MARKET INDEX", "COMPONENT COST OF CAPITAL", "CORPORATION", "PUBLIC OFFERING", "FIXED-RATE PERPETUAL PREFERRED STOCK", "ACCOUNT", "SYSTEMATIC RISK", "DEPENDENT", "EVALUATED PRICING", "ZERO", "RISK AVERSION", "MARKET RISK", "FLOAT", "CURRENT YIELD", "COMMON SHARES", "ASSETS", "LONG", "VALUATION", "MARKET", "MARKET VALUE", "INTEREST COVERAGE", "DEGREE OF FINANCIAL LEVERAGE", "BOOK VALUE OF EQUITY", "FREE CASH FLOW TO THE FIRM", "DIVIDEND YIELD", "CONVERTIBLE BOND", "INTEREST RATE", "COMMON STOCK", "BOND", "EXPANSION", "WILL", "RISK", "ASK", "CONSISTENT", "STOCK DIVIDEND", "MARGIN", "REPO", "EQUITY", "MEDIAN", "REVENUE", "ASSET BETA", "BUSINESS RISK", "SALES", "OPTION", "RENT", "MODE", "PUT");
	Clue = new Array("The required rate of return on common stock.", 
"A company that has similar business risk", 
"An asset that trades in a market in which buyers and sellers meet, decide on a price, and the seller then delivers the asset to the buyer and receives payment. The underlying is the asset or other derivative on which a particular derivative is based. The market for the underlying is also referred to as the spot market.", 
"Options that, if exercised, would result in the value received being worth more than the payment required to exercise.", 
"The ability to trade without delay at relatively low cost and in relatively large quantities.", 
"In the context of corporate finance, leverage refers to the use of fixed costs within a company´s cost structure. Fixed costs that are operating costs (such as depreciation or rent) create operating leverage. Fixed costs that are financial costs (such as interest expense) create financial leverage.", 
"An estimate of the cost of common equity that is produced by summing the before-tax cost of debt and a risk premium that captures the additional yield on a company´s stock relative to its bonds. The additional yield is often estimated using historical spreads between bond yields and stock yields.", 
"An option that gives the holder the right to buy an underlying asset from another party at a fixed price over a specific period of time.", 
"An approach to forecasting the return of a risky asset that views its expected return as the sum of the risk-free rate of interest and one or more risk premiums.", 
"Compensation for the additional risk of equity compared with debt.", 
"A distribution paid to shareholders based on the number of shares owned.", 
"The relationship among puts, calls, and forward contracts.", 
"A measure of the sensitivity of a given investment or portfolio to movements in the overall market.", 
"Options that, if exercised, would result in the value received being worth more than the payment required to exercise.", 
"One of the three factors (the other two are steepness and curvature) that empirically explain most of the changes in the shape of the yield curve. A shock to the level factor changes the yield for all maturities by an almost identical amount.", 
"An estimate of the equity risk premium that is based upon estimates provided by a panel of finance experts.", 
"Options that, if exercised, would result in the value received being worth more than the payment required to exercise.", 
"Options that, if exercised, would result in the value received being worth more than the payment required to exercise.", 
"The document that describes the terms of a new bond issue and helps investors perform their analysis on the issue.", 
"A bond containing an embedded call option that gives the issuer the right to buy the bond back from the investor at specified prices on pre-determined dates.", 
"With respect to a foreign exchange quotation of the price of one unit of a currency, the currency referred to in â€œone unit of a currency.â€", 
"A common or underlying element with which several variables are correlated.", 
"Assets used as benchmarks when applying the method of comparables to value an asset. Also called comps, guideline assets, or guideline companies.", 
"(CAPM) An equation describing the expected return on any asset (or portfolio) as a linear function of its beta relative to the market portfolio.", 
"Payment for lending funds.", 
"The amount of principal on a bond.", 
"In accounting contexts, cash on hand (e.g., petty cash and cash not yet deposited to the bank) and demand deposits held in banks and similar accounts that can be used in payment of obligations.", 
"The difference between the maximum and minimum values in a dataset.", 
"The region of countries using the euro as a currency.", 
"With respect to pension benefits or assets, said of an unconditional ownership interest.", 
"Factors related to the economy, such as the inflation rate, industrial production, or economic sector membership.", 
"The sum of the observations divided by the number of observations.", 
"The cost to a company of issuing preferred stock", 
"The value that investors forgo by choosing a particular course of action", 
"The expected return in excess of the risk-free rate for a portfolio with a sensitivity of 1 to one factor and a sensitivity of 0 to all other factors. Also called factor price.", 
"The rate of return that suppliers of capital require as compensation for their contribution of capital.", 
"The difference between the spot price and the futures price.", 
"The cost of producing an additional unit of a good.", 
"A model that explains a variable in terms of the values of a set of factors.", 
"The particular value calculated from sample observations using an estimator.", 
"A regulated venue for the trading of investment instruments.", 
"The return that owners of a company receive for the use of their capital and the assumption of financial risk when making their investments.", 
"(NPV) The present value of an investment´s cash inflows (benefits) minus the present value of its cash outflows (costs).", 
"To reduce the value of a future payment in allowance for how far away it is in time", 
"The amount for which one can sell something, or the amount one must pay to acquire something.", 
"A measure of central tendency computed by taking the nth root of the product of n non-negative values.", 
"Options that, if exercised, would result in the value received being worth more than the payment required to exercise.", 
"See value at risk.", 
"In technical analysis, a price range in which buying activity is sufficient to stop the decline in the price of a security.", 
"The amount of cash payable by a company to the bondholders when the bonds mature", 
"Corporations or other legal entities that ultimately serve as financial intermediaries between individuals and investment markets.", 
"Shareholders´ equity (total assets minus total liabilities) minus the value of preferred stock", 
"Fees charged to companies by investment bankers and other costs associated with raising new capital.", 
"A combination of interest rate call options designed to hedge a borrower against rate increases on a floating-rate loan.", 
"Process of estimating the market discount rate and price of a bond based on the quoted or flat prices of more frequently traded comparable bonds.", 
"the annualized amount of the most recent dividend.", 
"The quality of a debt issuer´s management.", 
"With reference to statistical inference, the subdivision dealing with estimating the value of a population parameter.", 
"With respect to double-entry accounting, a credit records increases in liability, owners´ equity, and revenue accounts or decreases in asset accounts", 
"Analysis that shows the range of possible outcomes as specific assumptions are changed.", 
"An objective measure of the quality and safety of a company´s debt based upon an analysis of the company´s ability to pay the promised cash flows, as well as an analysis of any indentures.", 
"The mix of debt and equity that a company uses to finance its business", 
"The cost of debt financing to a company, such as when it issues a bond or takes out a bank loan.", 
"The actual return on a debt security if it is held to maturity.", 
"Essentially, the purchase of some asset by the buyer (lessee) that is directly financed by the seller (lessor). Also called capital lease.", 
"As used in option pricing, the standard deviation of the continuously compounded returns on the underlying asset.", 
"See finance lease.", 
"The actual cash that would be available to the company´s investors after making all investments necessary to maintain the company as an ongoing enterprise (also referred to as free cash flow to the firm)", 
"An estimate of a country´s equity risk premium that is based upon the historical averages of the risk-free rate and the rate of return on the market portfolio.", 
"A measure of the approximate sensitivity of a security to a change in interest rates (i.e., a measure of interest rate risk).", 
"A situation in which average costs per unit of good or service produced fall as volume rises. In reference to mergers, the savings achieved through the consolidation of operations and elimination of duplicate resources.", 
"An estimation formula", 
"With reference to assets, the amount of cash or cash equivalents that would have to be paid to buy the same or an equivalent asset today", 
"Annual return that an investor earns on a bond if the investor purchases the bond today and holds it until maturity. It is the discount rate that equates the present value of the bond´s expected cash flows until maturity with the bond´s price. Also called yield-to-redemption or redemption yield.", 
"The present value of an investment´s cash inflows (benefits) minus the present value of its cash outflows (costs).", 
"The extent to which a company can effect, through the use of debt, a proportional change in the return on common equity that is greater than a given proportional change in operating income", 
"An extra return expected by investors for bearing some specified risk.", 
"The combination of a spot and a forward FX transaction.", 
"Economic characteristics of a business such as profitability, financial strength, and risk.", 
"In general, the difference in yield between different fixed income securities. Often used to refer to the difference between the yield-to-maturity and the benchmark.", 
"A solvency ratio calculated as total debt divided by total shareholders´ equity.", 
"Risks derived from events in the external financial markets, such as changes in equity prices, interest rates, or currency exchange rates.", 
"The probability that a borrower defaults or fails to meet its obligation to make full and timely payments of principal and interest, according to the terms of the debt security.", 
"In an investments context, a standard or point of reference for evaluating the performance of an investment portfolio.", 
"See public offering.", 
"An agreement allowing the lessee to use some asset for a period of time", 
"Probabilities that generally do not vary from person to person", 
"A method for estimating a company´s before-tax cost of debt based upon the yield on comparably rated bonds for maturities that closely match that of the company´s existing debt.", 
"Synonym for the risk premium approach.", 
"See market discount rate.", 
"An option that gives the holder the right to buy an underlying asset from another party at a fixed price over a specific period of time.", 
"(WACC) A weighted average of the after-tax required rates of return on a company´s common stock, preferred stock, and long-term debt, where the weights are the fraction of each source of financing in the company´s target capital structure.", 
"The interest rate promised in a contract", 
"Represents the performance of a specified security market, market segment, or asset class.", 
"The rate of return required by suppliers of capital for an individual source of a company´s funding, such as debt or equity.", 
"A legal entity with rights similar to those of a person. The chief officers, executives, or top managers act as agents for the firm and are legally entitled to authorize corporate activities and to enter into contracts on behalf of the business.", 
"An offering of securities in which any member of the public may buy the securities. Also called public offer.", 
"Nonconvertible, noncallable preferred stock with a specified dividend rate that has a claim on earnings senior to the claim of common stock, and no maturity date.", 
"With the accounting systems, a formal record of increases and decreases in a specific asset, liability, component of owners´ equity, revenue, or expense.", 
"Risk that affects the entire market or economy", 
"With reference to events, the property that the probability of one event occurring depends on (is related to) the occurrence of another event.", 
"See matrix pricing.", 
"A bond that does not pay a coupon but is priced at a discount and pays its full face value at maturity.", 
"The degree of an investor´s inability and unwillingness to take risk.", 
"The risk that arises from movements in interest rates, stock prices, exchange rates, and commodity prices.", 
"In the context of customer receipts, the amount of money that is in transit between payments made by customers and the funds that are usable by the company.", 
"The sum of the coupon payments received over the year divided by the flat price", 
"A type of security that represent an ownership interest in a company.", 
"Resources controlled by an enterprise as a result of past events and from which future economic benefits to the enterprise are expected to flow.", 
"The buyer of a derivative contract. Also refers to the position of owning a derivative.", 
"The process of determining the value of an asset or service on the basis of variables perceived to be related to future investment returns, or on the basis of comparisons with closely similar assets.", 
"A means of bringing buyers and sellers together to exchange goods and services.", 
"The price at which an asset or security can currently be bought or sold in an open market.", 
"A solvency ratio calculated as EBIT divided by interest payments.", 
"(DFL) The ratio of the percentage change in net income to the percentage change in operating income", 
"Shareholders´ equity (total assets minus total liabilities) minus the value of preferred stock", 
"The cash flow available to the company´s suppliers of capital after all operating expenses (including taxes) have been paid and necessary investments in working and fixed capital have been made.", 
"Annual dividends per share divided by share price.", 
"Bond with an embedded conversion option that gives the bondholder the right to convert their bonds into the issuer´s common stock during a pre-determined period at a pre-determined price.", 
"A rate of return that reflects the relationship between differently dated cash flows", 
"See common shares.", 
"Contractual agreement between the issuer and the bondholders.", 
"The period of a business cycle after its lowest point and before its highest point.", 
"A document associated with estate planning that outlines the rights others will have over one´s property after death. Also called testament.", 
"Exposure to uncertainty. The chance of a loss or adverse outcome as a result of an action, inaction, or external event.", 
"The price at which a dealer or trader is willing to sell an asset, typically qualified by a maximum quantity (ask size). See offer.", 
"With reference to estimators, describes an estimator for which the probability of estimates close to the value of the population parameter increases as sample size increases.", 
"A type of dividend in which a company distributes additional shares of its common stock to shareholders instead of cash.", 
"The amount of money that a trader deposits in a margin account. The term is derived from the stock market practice in which an investor borrows a portion of the money required to purchase a certain amount of stock. In futures markets, there is no borrowing so the margin is more of a down payment or performance bond.", 
"A form of collateralized loan involving the sale of a security with a simultaneous agreement by the seller to buy the same security back from the purchaser at an agreed-on price and future date. The party who sells the security at the inception of the repurchase agreement and buys it back at maturity is borrowing money from the other party, and the security sold and subsequently repurchased represents the collateral.", 
"Assets less liabilities", 
"The value of the middle item of a set of items that has been sorted into ascending or descending order", 
"The amount charged for the delivery of goods or services in the ordinary activities of a business over a stated period", 
"The unlevered beta", 
"The risk associated with operating earnings. Operating earnings are uncertain because total revenues and many of the expenditures contributed to produce those revenues are uncertain.", 
"Generally, a synonym for revenue", 
"A financial instrument that gives one party the right, but not the obligation, to buy or sell an underlying asset from or to another party at a fixed price over a specific period of time. Also referred to as contingent claim or option contract.", 
"Payment for the use of property.", 
"The most frequently occurring value in a set of observations.", 
"An option that gives the holder the right to sell an underlying asset to another party at a fixed price over a specific period of time.");
	AnswerHash = new Array(10663, 4587, 26725, 89965, 15080, 79154, 4004, 27320, 64269, 96827, 95092, 61108, 72234, 11451, 47307, 9443, 92264, 68663, 82357, 58678, 34026, 23246, 39790, 87706, 14724, 22799, 83629, 74198, 55510, 87698, 70134, 74487, 39045, 5345, 68520, 4068, 4173, 13429, 7540, 45549, 11974, 39909, 75956, 75775, 84534, 3830, 1147, 63518, 85372, 52103, 38994, 70323, 67943, 19021, 23082, 49361, 27614, 21578, 28317, 11834, 26918, 32933, 73581, 90592, 5105, 92620, 97008, 44021, 34300, 58102, 64456, 89050, 79682, 4749, 41054, 4881, 90908, 61547, 4207, 84237, 93527, 31831, 35001, 30984, 89941, 27853, 52492, 81882, 37120, 60409, 74581, 35341, 29020, 70831, 54655, 42419, 96385, 65862, 32396, 48938, 79180, 63699, 87894, 89280, 86727, 64325, 24530, 24700, 9716, 30913, 45318, 15671, 84365, 21156, 60244, 49446, 25800, 30582, 32180, 59496, 72620, 52535, 60833, 24989, 6115, 10770, 36474, 34103, 38796, 53098, 15481, 67310, 56489, 86281, 67315, 37052, 11221, 50338, 5388, 17549);
	WordX = new Array(2, 36, 5, 20, 45, 12, 20, 5, 0, 31, 61, 27, 55, 2, 19, 49, 24, 12, 21, 38, 16, 27, 22, 6, 45, 28, 49, 41, 16, 35, 49, 9, 40, 1, 25, 46, 24, 46, 46, 23, 37, 53, 11, 61, 36, 8, 62, 0, 24, 59, 11, 40, 56, 28, 8, 24, 9, 50, 2, 11, 5, 20, 45, 2, 50, 9, 28, 46, 4, 33, 51, 9, 2, 12, 52, 22, 0, 17, 68, 43, 45, 62, 56, 10, 27, 17, 60, 65, 8, 19, 38, 4, 36, 13, 25, 47, 68, 2, 11, 38, 43, 50, 21, 30, 6, 28, 32, 40, 34, 60, 67, 13, 17, 42, 9, 48, 56, 62, 0, 29, 44, 21, 68, 11, 15, 33, 52, 6, 46, 58, 19, 24, 36, 40, 64, 62, 23, 47, 30, 37);
	WordY = new Array(0, 2, 3, 4, 4, 5, 7, 8, 10, 10, 10, 12, 12, 13, 14, 14, 15, 16, 17, 17, 18, 21, 23, 25, 27, 28, 29, 30, 31, 32, 32, 33, 34, 36, 36, 36, 39, 39, 41, 42, 42, 43, 44, 44, 45, 46, 46, 47, 48, 48, 50, 51, 53, 54, 55, 56, 57, 58, 59, 59, 61, 61, 61, 63, 63, 64, 64, 65, 66, 68, 68, 69, 0, 2, 2, 3, 4, 4, 7, 9, 9, 9, 11, 12, 12, 14, 14, 14, 15, 17, 17, 18, 18, 19, 20, 20, 21, 25, 25, 25, 26, 27, 28, 28, 31, 32, 34, 34, 35, 36, 36, 39, 40, 41, 42, 43, 43, 43, 44, 44, 45, 48, 48, 49, 49, 49, 49, 50, 50, 50, 52, 54, 55, 57, 57, 60, 63, 65, 66, 66);
	LastHorizontalWord = 71;
	OnlyCheckOnce = false;
//-->
</script>

<script type="text/javascript"><!--

// EclipseCrossword (C) Copyright 2000-2013 Green Eclipse.
// The puzzle itself remains the property of its creator. Do not remove this copyright notice.

var BadChars = "`~!@^*()_={[}]\\|:;\"',<>/?";

var TableAcrossWord, TableDownWord;
var CurrentWord, PrevWordHorizontal, x, y, i, j;
var CrosswordFinished, Initialized;

// Check the user's browser and then initialize the puzzle.
if (document.getElementById("waitmessage") != null)
{
	document.getElementById("waitmessage").innerHTML = "Please wait while the crossword is loaded...";
	
	// Current game variables
	CurrentWord = -1;
	PrevWordHorizontal = false;
	
	// Create the cell-to-word arrays.
	TableAcrossWord = new Array(CrosswordWidth);
	for (var x = 0; x < CrosswordWidth; x++) TableAcrossWord[x] = new Array(CrosswordHeight);
	TableDownWord = new Array(CrosswordWidth);
	for (var x = 0; x < CrosswordWidth; x++) TableDownWord[x] = new Array(CrosswordHeight);
	for (var y = 0; y < CrosswordHeight; y++)
		for (var x = 0; x < CrosswordWidth; x++)
		{
			TableAcrossWord[x][y] = -1;
			TableDownWord[x][y] = -1;
		}
	
	// First, add the horizontal words to the puzzle.
	for (var i = 0; i <= LastHorizontalWord; i++)
	{
		x = WordX[i];
		y = WordY[i];
		for (var j = 0; j < WordLength[i]; j++)
		{
			TableAcrossWord[x + j][y] = i;
		}
	}
	
	// Second, add the vertical words to the puzzle.
	for (var i = LastHorizontalWord + 1; i < Words; i++)
	{
		x = WordX[i];
		y = WordY[i];
		for (var j = 0; j < WordLength[i]; j++)
		{
			TableDownWord[x][y + j] = i;
		}
	}
	
	// Now, insert the crossword table.
	document.writeln("<table id=\"crossword\" cellpadding=\"0\" cellspacing=\"0\" style=\"display: none; border-collapse: collapse;\">");
	for (var y = 0; y < CrosswordHeight; y++)
	{
		document.writeln("<tr>");
		for (var x = 0; x < CrosswordWidth; x++)
		{
			if (TableAcrossWord[x][y] >= 0 || TableDownWord[x][y] >= 0)
				document.write("<td id=\"c" + PadNumber(x) + PadNumber(y) + "\" class=\"ecw-box ecw-boxnormal_unsel\" onclick=\"SelectThisWord(event);\">&nbsp;</td>");
			else
				document.write("<td><\/td>");
		}
		document.writeln("<\/tr>");
	}
	document.writeln("<\/table>");
	
	// Finally, show the crossword and hide the wait message.
	Initialized = true;
	document.getElementById("waitmessage").style.display = "none";
	document.getElementById("crossword").style.display = "block";
}

// * * * * * * * * * *
// Event handlers

// Raised when a key is pressed in the word entry box.
function WordEntryKeyPress(event)
{
	if (CrosswordFinished) return;
	// Treat an Enter keypress as an OK click.
	if (CurrentWord >= 0 && event.keyCode == 13) OKClick();
}

// * * * * * * * * * *
// Helper functions

// Called when we're ready to start the crossword.
function BeginCrossword()
{
	if (Initialized)
	{
		document.getElementById("welcomemessage").style.display = "";
		document.getElementById("checkbutton").style.display = "";
	}
}

// Returns true if the string passed in contains any characters prone to evil.
function ContainsBadChars(theirWord)
{
	for (var i = 0; i < theirWord.length; i++)
		if (BadChars.indexOf(theirWord.charAt(i)) >= 0) return true;
	return false;
}

// Pads a number out to three characters.
function PadNumber(number)
{
	if (number < 10)
		return "00" + number;
	else if (number < 100)
		return "0" + number;
	else
		return "" +  number;
}

// Returns the table cell at a particular pair of coordinates.
function CellAt(x, y)
{
	return document.getElementById("c" + PadNumber(x) + PadNumber(y));
}

// Deselects the current word, if there's a word selected.  DOES not change the value of CurrentWord.
function DeselectCurrentWord()
{
	if (CurrentWord < 0) return;
	var x, y, i;
	
	document.getElementById("answerbox").style.display = "none";
	ChangeCurrentWordSelectedStyle(false);
	CurrentWord = -1;
	
}

// Changes the style of the cells in the current word.
function ChangeWordStyle(WordNumber, NewStyle)
{
	if (WordNumber< 0) return;
	var x = WordX[WordNumber];
	var y = WordY[WordNumber];
	
	if (WordNumber<= LastHorizontalWord)
		for (i = 0; i < WordLength[WordNumber]; i++)
			CellAt(x + i, y).className = NewStyle;
	else
		for (i = 0; i < WordLength[WordNumber]; i++)
			CellAt(x, y + i).className = NewStyle;
}

// Changes the style of the cells in the current word between the selected/unselected form.
function ChangeCurrentWordSelectedStyle(IsSelected)
{
	if (CurrentWord < 0) return;
	var x = WordX[CurrentWord];
	var y = WordY[CurrentWord];
	
	if (CurrentWord <= LastHorizontalWord)
		for (i = 0; i < WordLength[CurrentWord]; i++)
			CellAt(x + i, y).className = CellAt(x + i, y).className.replace(IsSelected ? "_unsel" : "_sel", IsSelected ? "_sel" : "_unsel");
	else
		for (i = 0; i < WordLength[CurrentWord]; i++)
			CellAt(x, y + i).className = CellAt(x, y + i).className.replace(IsSelected ? "_unsel" : "_sel", IsSelected ? "_sel" : "_unsel");
}

// Selects the new word by parsing the name of the TD element referenced by the 
// event object, and then applying styles as necessary.
function SelectThisWord(event)
{
	if (CrosswordFinished) return;
	var x, y, i, TheirWord, TableCell;
	
	// Deselect the previous word if one was selected.
	document.getElementById("welcomemessage").style.display = "none";
	if (CurrentWord >= 0) OKClick();
	DeselectCurrentWord();
	
	// Determine the coordinates of the cell they clicked, and then the word that
	// they clicked.
	var target = (event.srcElement ? event.srcElement: event.target);
	x = parseInt(target.id.substring(1, 4), 10);
	y = parseInt(target.id.substring(4, 7), 10);
	
	// If they clicked an intersection, choose the type of word that was NOT selected last time.
	if (TableAcrossWord[x][y] >= 0 && TableDownWord[x][y] >= 0)
		CurrentWord = PrevWordHorizontal ? TableDownWord[x][y] : TableAcrossWord[x][y];
	else if (TableAcrossWord[x][y] >= 0)
		CurrentWord = TableAcrossWord[x][y];
	else if (TableDownWord[x][y] >= 0)
		CurrentWord = TableDownWord[x][y];

	PrevWordHorizontal = (CurrentWord <= LastHorizontalWord);
	
	// Now, change the style of the cells in this word.
	ChangeCurrentWordSelectedStyle(true);
	
	// Then, prepare the answer box.
	x = WordX[CurrentWord];
	y = WordY[CurrentWord];
	TheirWord = "";
	var TheirWordLength = 0;
	for (i = 0; i < WordLength[CurrentWord]; i++)
	{
		// Find the appropriate table cell.
		if (CurrentWord <= LastHorizontalWord)
			TableCell = CellAt(x + i, y);
		else
			TableCell = CellAt(x, y + i);
		// Add its contents to the word we're building.
		if (TableCell.innerHTML != null && TableCell.innerHTML.length > 0 && TableCell.innerHTML != " " && TableCell.innerHTML.toLowerCase() != "&nbsp;")
		{
			TheirWord += TableCell.innerHTML.toUpperCase();
			TheirWordLength++;
		}
		else
		{
			TheirWord += "&bull;";
		}
	}
	
	document.getElementById("wordlabel").innerHTML = TheirWord;
	document.getElementById("wordinfo").innerHTML = ((CurrentWord <= LastHorizontalWord) ? "Across, " : "Down, ") + WordLength[CurrentWord] + " letters.";
	document.getElementById("wordclue").innerHTML = Clue[CurrentWord];
	document.getElementById("worderror").style.display = "none";
	document.getElementById("cheatbutton").style.display = (Word.length == 0) ? "none" : "";
	if (TheirWordLength == WordLength[CurrentWord])
		document.getElementById("wordentry").value = TheirWord.replace(/&AMP;/g, '&');
	else
		document.getElementById("wordentry").value = "";
	
	// Finally, show the answer box.
	document.getElementById("answerbox").style.display = "block";
	try
	{
		document.getElementById("wordentry").focus();
		document.getElementById("wordentry").select();
	}
	catch (e)
	{
	}
	
}

// Called when the user clicks the OK link.
function OKClick()
{
	var TheirWord, x, y, i, TableCell;
	if (CrosswordFinished) return;
	if (document.getElementById("okbutton").disabled) return;
	
	// First, validate the entry.
	TheirWord = document.getElementById("wordentry").value.toUpperCase();
	if (TheirWord.length == 0)
	{
		DeselectCurrentWord();
		return;
	}
	if (ContainsBadChars(TheirWord))
	{
		document.getElementById("worderror").innerHTML = "The word that you typed contains invalid characters.  Please type only letters in the box above.";
		document.getElementById("worderror").style.display = "block";
		return;
	}
	if (TheirWord.length < WordLength[CurrentWord])
	{
		document.getElementById("worderror").innerHTML  = "You did not type enough letters.  This word has " + WordLength[CurrentWord] + " letters.";
		document.getElementById("worderror").style.display = "block";
		return;
	}
	if (TheirWord.length > WordLength[CurrentWord])
	{
		document.getElementById("worderror").innerHTML = "You typed too many letters.  This word has " + WordLength[CurrentWord] + " letters.";
		document.getElementById("worderror").style.display = "block";
		return;
	}
	
	// If we made it this far, they typed an acceptable word, so add these letters to the puzzle and hide the entry box.
	x = WordX[CurrentWord];
	y = WordY[CurrentWord];
	for (i = 0; i < TheirWord.length; i++)
	{
		TableCell = CellAt(x + (CurrentWord <= LastHorizontalWord ? i : 0), y + (CurrentWord > LastHorizontalWord ? i : 0));
		TableCell.innerHTML = TheirWord.substring(i, i + 1);
	}
	DeselectCurrentWord();
}

// Called when the "check puzzle" link is clicked.
function CheckClick()
{
	var i, j, x, y, UserEntry, ErrorsFound = 0, EmptyFound = 0, TableCell;
	if (CrosswordFinished) return;
	DeselectCurrentWord();
	
	for (y = 0; y < CrosswordHeight; y++)
	for (x = 0; x < CrosswordWidth; x++)
		if (TableAcrossWord[x][y] >= 0 || TableDownWord[x][y] >= 0)
		{
			TableCell = CellAt(x, y);
			if (TableCell.className == "ecw-box ecw-boxerror_unsel") TableCell.className = "ecw-box ecw-boxnormal_unsel";
		}
		
	for (i = 0; i < Words; i++)
	{
		// Get the user's entry for this word.
		UserEntry = "";
		for (j = 0; j < WordLength[i]; j++)
		{
			if (i <= LastHorizontalWord)
				TableCell = CellAt(WordX[i] + j, WordY[i]);
			else
				TableCell = CellAt(WordX[i], WordY[i] + j);
			if (TableCell.innerHTML.length > 0 && TableCell.innerHTML.toLowerCase() != "&nbsp;")
			{
				UserEntry += TableCell.innerHTML.toUpperCase();
			}
			else
			{
				UserEntry = "";
				EmptyFound++;
				break;
			}
		}
		UserEntry = UserEntry.replace(/&AMP;/g, '&');
		// If this word doesn't match, it's an error.
		if (HashWord(UserEntry) != AnswerHash[i] && UserEntry.length > 0)
		{
			ErrorsFound++;
			ChangeWordStyle(i, "ecw-box ecw-boxerror_unsel");
		}
	}
	
	// If they can only check once, disable things prematurely.
	if ( OnlyCheckOnce )
	{
		CrosswordFinished = true;
		document.getElementById("checkbutton").style.display = "none";
	}
	
	// If errors were found, just exit now.
	if (ErrorsFound > 0 && EmptyFound > 0)
		document.getElementById("welcomemessage").innerHTML = ErrorsFound + (ErrorsFound > 1 ? " errors" : " error") + " and " + EmptyFound + (EmptyFound > 1 ? " incomplete words were" : " incomplete word was") + " found.";
	else if (ErrorsFound > 0)
		document.getElementById("welcomemessage").innerHTML = ErrorsFound + (ErrorsFound > 1 ? " errors were" : " error was") + " found.";
	else if (EmptyFound > 0)
		document.getElementById("welcomemessage").innerHTML = "No errors were found, but " + EmptyFound + (EmptyFound > 1 ? " incomplete words were" : " incomplete word was") + " found.";
	
	if (ErrorsFound + EmptyFound > 0)
	{
		document.getElementById("welcomemessage").style.display = "";
		return;
	}
			
	// They finished the puzzle!
	CrosswordFinished = true;
	document.getElementById("checkbutton").style.display = "none";
	document.getElementById("congratulations").style.display = "block";
	document.getElementById("welcomemessage").style.display = "none";
}

// Called when the "cheat" link is clicked.
function CheatClick()
{
	if (CrosswordFinished) return;
	var OldWord = CurrentWord;
	document.getElementById("wordentry").value = Word[CurrentWord];
	OKClick();
	ChangeWordStyle(OldWord, "ecw-box ecw-boxcheated_unsel");
}

// Returns a one-way hash for a word.
function HashWord(Word)
{
	var x = (Word.charCodeAt(0) * 719) % 1138;
	var Hash = 837;
	var i;
	for (i = 1; i <= Word.length; i++)
		Hash = (Hash * i + 5 + (Word.charCodeAt(i - 1) - 64) * x) % 98503;
	return Hash;
}

//-->
</script>

</td>

<td valign="top" style="padding-left: 1em;">

<div class="ecw-copyright">
	<a href="http://www.eclipsecrossword.com/" onclick="this.target='_blank'" style="font-weight: bold;">EclipseCrossword</a> &copy; 2000-2013
</div>

<div id="welcomemessage" class="ecw-answerbox" style="display:none;">
<h3>Welcome!</h3>
<p>Click a word in the puzzle to get started.</p>
</div>

<div id="answerbox" class="ecw-answerbox" style="display:none;">
<h3 id="wordlabel" class="ecw-wordlabel"> &nbsp;</h3>
<div id="wordinfo" class="ecw-wordinfo"> </div>
<div id="wordclue" class="ecw-cluebox"> </div>
<div style="margin-top: 1em;">
	<input class="ecw-input" id="wordentry" type="text" size="24" style="font-weight: bold; text-transform:uppercase;" onkeypress="WordEntryKeyPress(event)" onchange="WordEntryKeyPress(event)" />
</div>
<div id="worderror" class="ecw-worderror"></div>

<table border="0" cellspacing="0" cellpadding="0" width="100%" style="margin-top:1em;"><tbody><tr><td>
<button id="cheatbutton" type="button" class="ecw-input ecw-button" onclick="CheatClick();">Solve</button>
</td><td align="right">
<button id="okbutton" type="button" class="ecw-input ecw-button" onclick="OKClick();" style="font-weight: bold;">OK</button> &nbsp;
<button id="cancelbutton" type="button" class="ecw-input ecw-button" onclick="DeselectCurrentWord();">Cancel</button>
</td></tr></tbody></table>

</div>

<div id="congratulations" class="ecw-answerbox" style="display:none;">
<h3>Congratulations!</h3>
<p>You have completed this <a href="http://www.eclipsecrossword.com" style="color: black; text-decoration:none;">crossword puzzle</a>.
</p>
<p>If you would like to be able to create interactive
<a href="http://www.eclipsecrossword.com" style="color: black; text-decoration:none;">crosswords</a>
like this yourself, get <a href="http://www.eclipsecrossword.com" onclick="this.target='_blank'">EclipseCrossword</a>
from Green Eclipse&mdash;it's free!
</p>
</div>

</td></tr></table>

<div style="margin-top: 1em;">
	<button id="checkbutton" type="button" onclick="CheckClick();" style="display: none;">Check puzzle</button>
</div>

<script type="text/javascript"><!--
BeginCrossword();
//-->
</script>

<!-- Created with EclipseCrossword, (C) Copyright 2000-2013 Green Eclipse.  eclipsecrossword.com -->

</body></html>

